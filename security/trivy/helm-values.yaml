# Trivy Operator Helm Values
# https://github.com/aquasecurity/trivy-operator

# Disable TTL-based periodic rescan (scan only on new image deployment)
extraEnv:
- name: OPERATOR_SCANNER_REPORT_TTL
  value: ""

# Operator image
image:
  registry: zot0213.kro.kr
  repository: security/trivy-operator
  tag: "0.28.0"
  pullPolicy: IfNotPresent

# Trivy scanner image used by the operator
trivy:
  image:
    registry: zot0213.kro.kr
    repository: security/trivy
    tag: "0.68.2"
  mode: Standalone
  storageClassEnabled: true
  storageSize: "5Gi"
  # Scan job resources (requests = limits for QoS Guaranteed class)
  resources:
    requests:
      cpu: 100m
      memory: 500Mi
    limits:
      memory: 500Mi

# Operator settings
operator:
  replicas: 1
  vulnerabilityScannerEnabled: true
  configAuditScannerEnabled: true
  rbacAssessmentScannerEnabled: false
  infraAssessmentScannerEnabled: false
  clusterComplianceEnabled: false
  exposedSecretScannerEnabled: false
  sbomGenerationEnabled: false
  scanJobTimeout: 10m
  scanJobsConcurrentLimit: 2
  scannerReportTTL: ""  # Empty = disable TTL-based rescan, scan only on new image

# Exclude system namespaces from scanning
excludeNamespaces: "kube-system,kube-public,kube-node-lease"

# Resource settings for operator (based on VPA recommendations)
# memory requests = limits for QoS Guaranteed class
resources:
  requests:
    cpu: 50m
    memory: 384Mi
  limits:
    memory: 384Mi

# RBAC
rbac:
  create: true

# Service account
serviceAccount:
  create: true

# Pod security
podSecurityContext:
  runAsUser: 65534
  runAsNonRoot: true
  fsGroup: 65534

securityContext:
  privileged: false
  readOnlyRootFilesystem: true
  allowPrivilegeEscalation: false
  capabilities:
    drop:
    - ALL

# ServiceMonitor for Prometheus
serviceMonitor:
  enabled: true

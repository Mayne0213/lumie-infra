fullnameOverride: code-server

image:
  repository: codercom/code-server
  tag: 4.104.2
  pullPolicy: Always

# Persistence configuration for workspace data
persistence:
  enabled: true
  accessMode: ReadWriteOnce
  size: 20Gi
  storageClassName: local-path

# Use existing secret for password
existingSecret: code-server-password
existingSecretKey: password

# Ingress configuration (will use main ingress)
ingress:
  enabled: false

# Service configuration
service:
  type: ClusterIP
  port: 8080

# Resource limits
resources:
  requests:
    cpu: 300m  # Reduced to 30% of original (1000m -> 300m)
    memory: 4Gi  # 4GB (within available ~15GB)

# Security context
securityContext:
  enabled: true
  fsGroup: 1000
  runAsUser: 1000

# Volume permissions
volumePermissions:
  enabled: true

# Extra arguments for code-server
extraArgs:
  - --auth
  - password

# Extra environment variables
extraVars:
  - name: TZ
    value: "Asia/Seoul"
  - name: KUBECONFIG
    value: "/host/etc/rancher/k3s/k3s.yaml"
  - name: PATH
    value: "/host/usr/local/bin:/host/usr/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin"

# Mount host paths for kubectl access
extraVolumes:
  - name: host-bin
    hostPath:
      path: /usr/local/bin
      type: Directory
  - name: host-k3s-config
    hostPath:
      path: /etc/rancher/k3s
      type: Directory

extraVolumeMounts:
  - name: host-bin
    mountPath: /host/usr/local/bin
    readOnly: true
  - name: host-k3s-config
    mountPath: /host/etc/rancher/k3s
    readOnly: true

# Health checks
livenessProbe:
  enabled: true
  httpGet:
    path: /healthz
    port: 8080
  initialDelaySeconds: 30
  periodSeconds: 10

readinessProbe:
  enabled: true
  httpGet:
    path: /healthz
    port: 8080
  initialDelaySeconds: 10
  periodSeconds: 5

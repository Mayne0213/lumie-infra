# Lumie Development Environment
# ArgoCD manages: namespace, database, secrets
# Tilt manages: deployments, services

common:
  name: lumie-dev

  # Disable deployment (Tilt manages this)
  deployment:
    enabled: false

  # Disable service (Tilt manages this)
  service:
    enabled: false

  ingress:
    enabled: false

  # CNPG Database for dev environment
  database:
    enabled: true
    clusterName: lumie-dev
    instances: 1  # Single instance for dev
    version: "18.1"
    name: lumie
    owner: lumie
    encoding: UTF8
    localeCollate: C
    localeCType: C
    enableSuperuserAccess: true
    # Use Vault-managed credentials
    bootstrap:
      secret: lumie-dev-db-bootstrap-secret
    storage:
      class: local-path
      size: 5Gi  # Smaller for dev
    resources:
      memory: 256Mi
      cpu: 50m
    postgresql:
      parameters:
        max_connections: "100"
        shared_buffers: "64MB"
        effective_cache_size: "192MB"
    backup:
      enabled: false  # No backup for dev

  # Vault Static Secrets (uses vault/vault-auth)
  vaultStaticSecrets:
    # Database bootstrap credentials for CNPG
    - name: lumie-dev-db-bootstrap-vss
      path: storage/postgresql
      destination:
        name: lumie-dev-db-bootstrap-secret
        type: kubernetes.io/basic-auth
        transformation:
          templates:
            username: "{{ .Secrets.POSTGRES_USER }}"
            password: "{{ .Secrets.POSTGRES_PASSWORD }}"
    # Database credentials for services
    - name: lumie-dev-db-vss
      path: storage/postgresql
      destination:
        name: lumie-dev-db-secrets
        transformation:
          templates:
            username: "{{ .Secrets.POSTGRES_USER }}"
            password: "{{ .Secrets.POSTGRES_PASSWORD }}"
    # RabbitMQ credentials
    - name: lumie-dev-rabbitmq-vss
      path: platform/rabbitmq
      destination:
        name: lumie-dev-rabbitmq-secrets
        transformation:
          templates:
            password: "{{ .Secrets.RABBITMQ_PASSWORD }}"
    # Redis credentials
    - name: lumie-dev-redis-vss
      path: platform/redis
      destination:
        name: lumie-dev-redis-secrets
        transformation:
          templates:
            password: "{{ .Secrets.REDIS_PASSWORD }}"
    # JWT secrets (for auth-svc)
    - name: lumie-dev-jwt-vss
      path: security/jwt
      destination:
        name: lumie-dev-jwt-secrets
        transformation:
          templates:
            secret: "{{ .Secrets.JWT_SECRET_KEY }}"
    # MinIO credentials (for file-svc)
    - name: lumie-dev-minio-vss
      path: bootstrap/minio
      destination:
        name: lumie-dev-minio-secrets
        transformation:
          templates:
            access-key: "{{ .Secrets.MINIO_ACCESS_KEY_ID }}"
            secret-key: "{{ .Secrets.MINIO_SECRET_ACCESS_KEY }}"
            endpoint: "{{ .Secrets.MINIO_ENDPOINT }}"

# Common chart values for mas

common:
  name: mas

  # Disable deployment (external chart creates it)
  deployment:
    enabled: false

  service:
    enabled: false

  ingress:
    enabled: false

  # Vault Static Secrets (VSO)
  vaultStaticSecrets:
    - name: mas-vss
      path: applications/mas
      destination:
        name: mas-api-keys
        transformation:
          templates:
            anthropic-api-key: "{{ .Secrets.ANTHROPIC_API_KEY }}"

  # RBAC configuration
  rbac:
    enabled: true
    serviceAccount:
      create: true
      name: mas
    # ClusterRoles
    clusterRoles:
      - name: mas-viewer
        rules:
          - apiGroups: [""]
            resources:
              - pods
              - pods/log
              - services
              - endpoints
              - namespaces
              - nodes
              - persistentvolumeclaims
              - configmaps
            verbs: ["get", "list", "watch"]
          - apiGroups: ["apps"]
            resources:
              - deployments
              - statefulsets
              - daemonsets
              - replicasets
            verbs: ["get", "list", "watch"]
          - apiGroups: ["batch"]
            resources:
              - jobs
              - cronjobs
            verbs: ["get", "list", "watch"]
          - apiGroups: ["networking.k8s.io"]
            resources:
              - ingresses
            verbs: ["get", "list", "watch"]
          - apiGroups: ["argoproj.io"]
            resources:
              - applications
            verbs: ["get", "list", "watch"]
          - apiGroups: [""]
            resources:
              - pods/status
              - services/status
            verbs: ["get"]
      - name: mas-writer
        rules:
          - apiGroups: [""]
            resources:
              - pods
              - services
              - configmaps
              - secrets
            verbs: ["create", "update", "patch", "delete"]
          - apiGroups: ["apps"]
            resources:
              - deployments
              - statefulsets
              - daemonsets
              - replicasets
            verbs: ["create", "update", "patch", "delete"]
          - apiGroups: ["networking.k8s.io"]
            resources:
              - ingresses
            verbs: ["create", "update", "patch", "delete"]
          - apiGroups: ["batch"]
            resources:
              - jobs
              - cronjobs
            verbs: ["create", "update", "patch", "delete"]
          - apiGroups: [""]
            resources:
              - namespaces
            verbs: ["create", "update", "patch"]
          - apiGroups: ["argoproj.io"]
            resources:
              - applications
            verbs: ["create", "update", "patch", "delete"]
    # ClusterRoleBindings
    clusterRoleBindings:
      - name: mas-viewer-binding
        roleRef:
          kind: ClusterRole
          name: mas-viewer
        subjects:
          - kind: ServiceAccount
            name: mas
            namespace: mas
      - name: mas-writer-binding
        roleRef:
          kind: ClusterRole
          name: mas-writer
        subjects:
          - kind: ServiceAccount
            name: mas
            namespace: mas

  # CNPG Database configuration
  database:
    enabled: true
    instances: 2
    version: "16.6"
    name: mas
    owner: mas
    storage:
      class: local-path
      size: 1Gi
    resources:
      memory: 512Mi
      cpu: 50m
    backup:
      enabled: false

# craftycontroller Helm chart values
# Minecraft server manager - https://craftycontrol.com/

fullnameOverride: crafty

image:
  repository: registry.gitlab.com/crafty-controller/crafty-4
  tag: latest
  pullPolicy: Always

resources:
  requests:
    cpu: 35m
    memory: 128Mi
  limits:
    cpu: 105m
    memory: 192Mi

# Health checks with startupProbe for slow initialization
startupProbe:
  httpGet:
    path: /
    port: https
    scheme: HTTPS
  periodSeconds: 10
  failureThreshold: 30

livenessProbe:
  initialDelaySeconds: 0
  periodSeconds: 10
  httpGet:
    path: /
    port: https
    scheme: HTTPS

readinessProbe:
  initialDelaySeconds: 0
  periodSeconds: 10
  httpGet:
    path: /
    port: https
    scheme: HTTPS

# Use existing PVCs (don't create new ones by omitting requests)
persistence:
  crafty-app-config:
    enabled: false  # Using additionalVolumes for existing PVC
  crafty-servers:
    enabled: true
    # No requests = don't create PVC, use existing one

# Mount existing crafty-config PVC
additionalVolumes:
  - name: crafty-config
    persistentVolumeClaim:
      claimName: crafty-config

additionalVolumeMounts:
  - name: crafty-config
    mountPath: /crafty/app/config

# Services
services:
  https:
    type: ClusterIP
    ports:
      - name: https
        port: 8443
        protocol: TCP
      - name: dynmap
        port: 8123
        protocol: TCP
  # Minecraft service defined in manifests/minecraft-service.yaml (LoadBalancer)
  minecraft:
    type: ClusterIP
    ports:
      - name: minecraft
        port: 25565
        protocol: TCP

# Security context
podSecurityContext:
  fsGroup: 0

securityContext:
  runAsNonRoot: true
  runAsUser: 1000
  runAsGroup: 0

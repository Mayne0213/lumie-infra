apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

resources:
- https://infra.tekton.dev/tekton-releases/dashboard/latest/release-full.yaml
- manifests/ingress.yaml

# Override upstream images to use zot registry
images:
- name: ghcr.io/tektoncd/dashboard/dashboard-9623576a202fe86c8b7d1bc489905f86
  newName: zot0213.kro.kr/tekton/dashboard
  newTag: v0.63.1

patches:
- target:
    group: apiextensions.k8s.io
    version: v1
    kind: CustomResourceDefinition
  patch: |-
    - op: replace
      path: /metadata/labels/app.kubernetes.io~1instance
      value: tekton-dashboard
# Schedule on master node
- target:
    group: apps
    version: v1
    kind: Deployment
  patch: |-
    - op: add
      path: /spec/template/spec/tolerations
      value:
        - key: "node-role.kubernetes.io/control-plane"
          operator: "Exists"
          effect: "NoSchedule"
    - op: add
      path: /spec/template/spec/nodeSelector
      value:
        node-role.kubernetes.io/control-plane: "true"

apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

resources:
- https://storage.googleapis.com/tekton-releases/triggers/latest/release.yaml
- https://storage.googleapis.com/tekton-releases/triggers/latest/interceptors.yaml

# Override upstream images to use zot registry (mirrors ghcr.io/tektoncd/**)
# Image names include hash suffix - must match exactly for Zot on-demand sync
images:
- name: ghcr.io/tektoncd/triggers/controller-f656ca31de179ab913fa76abc255c315
  newName: zot.mayne.kro.kr/tektoncd/triggers/controller-f656ca31de179ab913fa76abc255c315
  newTag: v0.34.0
- name: ghcr.io/tektoncd/triggers/webhook-dd1edc925ee1772a9f76e2c1bc291ef6
  newName: zot.mayne.kro.kr/tektoncd/triggers/webhook-dd1edc925ee1772a9f76e2c1bc291ef6
  newTag: v0.34.0
- name: ghcr.io/tektoncd/triggers/interceptors-3176d6a3f314c3655b30bfd36e421dd5
  newName: zot.mayne.kro.kr/tektoncd/triggers/interceptors-3176d6a3f314c3655b30bfd36e421dd5
  newTag: v0.34.0
- name: ghcr.io/tektoncd/triggers/eventlistenersink-7ad1faa98cddbcb0c24990303b220bb8
  newName: zot.mayne.kro.kr/tektoncd/triggers/eventlistenersink-7ad1faa98cddbcb0c24990303b220bb8
  newTag: v0.34.0

patches:
- target:
    group: apiextensions.k8s.io
    version: v1
    kind: CustomResourceDefinition
  patch: |-
    - op: replace
      path: /metadata/labels/app.kubernetes.io~1instance
      value: tekton-triggers
# Override -el-image argument to use zot registry (index 4 is the image value after -el-image flag)
- target:
    group: apps
    version: v1
    kind: Deployment
    name: tekton-triggers-controller
  patch: |-
    - op: replace
      path: /spec/template/spec/containers/0/args/4
      value: zot.mayne.kro.kr/tektoncd/triggers/eventlistenersink-7ad1faa98cddbcb0c24990303b220bb8:v0.34.0

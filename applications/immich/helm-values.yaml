# Immich Helm Values
# Chart: https://github.com/immich-app/immich-charts
# Self-hosted photo and video management solution

# Immich configuration
immich:
  persistence:
    library:
      existingClaim: immich-library

# Server component
server:
  enabled: true
  image:
    repository: ghcr.io/immich-app/immich-server
    pullPolicy: IfNotPresent

  ingress:
    main:
      enabled: true
      className: traefik
      annotations:
        cert-manager.io/cluster-issuer: letsencrypt-prod
      hosts:
        - host: immich0213.kro.kr
          paths:
            - path: /
              pathType: Prefix
      tls:
        - secretName: immich-tls
          hosts:
            - immich0213.kro.kr

  resources:
    requests:
      cpu: 10m
      memory: 256Mi
    limits:
      memory: 1Gi

# Machine Learning component
machine-learning:
  enabled: true
  image:
    repository: ghcr.io/immich-app/immich-machine-learning
    pullPolicy: IfNotPresent

  persistence:
    cache:
      enabled: true
      size: 10Gi
      storageClass: longhorn
      accessMode: ReadWriteOnce

  resources:
    requests:
      cpu: 10m
      memory: 512Mi
    limits:
      memory: 4Gi

# Redis/Valkey for job queue
valkey:
  enabled: true
  image:
    repository: docker.io/valkey/valkey
    tag: 9.0-alpine

  persistence:
    data:
      enabled: true
      size: 1Gi
      storageClass: longhorn
      accessMode: ReadWriteOnce

  resources:
    requests:
      cpu: 5m
      memory: 64Mi
    limits:
      memory: 256Mi

# External PostgreSQL configuration (using existing cloudnative-pg)
# Database connection via environment variables
env:
  DB_HOSTNAME: postgresql-rw.postgresql.svc.cluster.local
  DB_PORT: "5432"
  DB_DATABASE_NAME: immich
  DB_USERNAME: bluemayne
  DB_PASSWORD:
    valueFrom:
      secretKeyRef:
        name: immich-postgres-password
        key: password

# S3/MinIO storage for assets (optional - can use local storage instead)
# Uncomment below if you want to use MinIO for storage
# env:
#   UPLOAD_LOCATION: /usr/src/app/upload
#   IMMICH_MEDIA_LOCATION: /usr/src/app/upload

# Disable internal PostgreSQL (using external)
postgresql:
  enabled: false

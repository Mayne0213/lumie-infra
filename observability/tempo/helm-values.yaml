# Tempo Helm Values
# Chart: https://github.com/grafana/helm-charts/tree/main/charts/tempo
#
# Architecture:
# - Single binary (monolithic) mode for small clusters
# - Local filesystem for trace storage
# - OTLP receiver for OpenTelemetry data
# - Integrates with Grafana for trace visualization

# Run on master node for stability
tolerations:
  - key: node-role.kubernetes.io/control-plane
    operator: Exists
    effect: NoSchedule
nodeSelector:
  node-role.kubernetes.io/control-plane: "true"

# =============================================================================
# Resource Limits (optimized for small cluster)
# =============================================================================
resources:
  requests:
    cpu: 50m
    memory: 128Mi
  limits:
    memory: 128Mi

# =============================================================================
# Tempo Configuration
# =============================================================================
tempo:
  # Receivers - protocols Tempo accepts
  receivers:
    otlp:
      protocols:
        grpc:
          endpoint: 0.0.0.0:4317
        http:
          endpoint: 0.0.0.0:4318

  # Retention settings
  retention: 72h  # Keep traces for 3 days

  # Backend storage (local filesystem)
  storage:
    trace:
      backend: local
      local:
        path: /var/tempo/traces
      wal:
        path: /var/tempo/wal

  # Query settings
  querier:
    frontend_worker:
      frontend_address: ""

  # Metrics generator for trace-derived metrics
  metricsGenerator:
    enabled: true
    remoteWriteUrl: http://prometheus-kube-prometheus-prometheus.prometheus.svc:9090/api/v1/write

# =============================================================================
# Persistence (local-path PVC)
# =============================================================================
persistence:
  enabled: true
  storageClassName: local-path
  size: 5Gi

# =============================================================================
# Service
# =============================================================================
service:
  type: ClusterIP

# =============================================================================
# ServiceMonitor for Prometheus
# =============================================================================
serviceMonitor:
  enabled: true
  additionalLabels:
    release: prometheus

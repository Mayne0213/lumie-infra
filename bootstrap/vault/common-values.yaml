# Common chart values for vault
# Note: VSO (Vault Secrets Operator) is now the preferred method for new deployments
# ClusterSecretStore is kept for backward compatibility during ESO â†’ VSO migration

common:
  name: vault

  # Disable deployment (external chart creates it)
  deployment:
    enabled: false

  service:
    enabled: false

  ingress:
    enabled: false

  # ClusterSecretStore for External Secrets Operator (backward compatibility)
  # TODO: Remove after all ExternalSecrets are migrated to VaultStaticSecrets
  clusterSecretStore:
    enabled: true
    name: vault-backend
    vault:
      server: http://vault.vault.svc.cluster.local:8200
      path: secret
      version: v2
      auth:
        mountPath: kubernetes
        role: external-secrets
        serviceAccountRef:
          name: external-secrets
          namespace: external-secrets

  # RBAC for Vault token reviewer (still needed for VSO)
  rbac:
    enabled: true
    serviceAccount:
      create: false
    clusterRoles:
      - name: system:auth-delegator
        rules:
          - apiGroups: ["authentication.k8s.io"]
            resources: ["tokenreviews"]
            verbs: ["create"]
          - apiGroups: ["authorization.k8s.io"]
            resources: ["subjectaccessreviews"]
            verbs: ["create"]
    clusterRoleBindings:
      - name: vault-token-reviewer
        roleRef:
          kind: ClusterRole
          name: system:auth-delegator
        subjects:
          - kind: ServiceAccount
            name: vault
            namespace: vault

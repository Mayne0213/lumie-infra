# PgBouncer configuration for multi-tenancy support
# Using session mode to maintain search_path across transactions

replicaCount: 1

image:
  registry: zot0213.kro.kr
  repository: storage/pgbouncer
  tag: "1.25.1"
  pullPolicy: IfNotPresent

service:
  type: ClusterIP
  port: 5432

config:
  # Admin credentials for PgBouncer (matches CNPG lumie-dev-db-app secret)
  adminUser: lumie
  adminPassword: nIbBiyobn24YVHOU2WrFr0qRCeX3ZOAkCoZrMadcx2mPGuPAh52AWd2cvrqD3FtH

  databases:
    lumie:
      host: lumie-dev-db-rw.lumie-dev.svc.cluster.local
      port: 5432
      dbname: lumie

  pgbouncer:
    pool_mode: session
    max_client_conn: 100
    default_pool_size: 20
    min_pool_size: 5
    reserve_pool_size: 5
    server_reset_query: "SET search_path TO public"
    server_reset_query_always: 1
    ignore_startup_parameters: extra_float_digits

resources:
  requests:
    cpu: 10m
    memory: 32Mi
  limits:
    memory: 64Mi

securityContext:
  allowPrivilegeEscalation: false
  capabilities:
    drop:
    - ALL
  readOnlyRootFilesystem: true
  runAsNonRoot: true
  runAsUser: 70
  runAsGroup: 70

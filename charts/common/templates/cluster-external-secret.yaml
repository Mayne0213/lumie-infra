{{- range $ces := .Values.common.clusterExternalSecrets }}
---
apiVersion: external-secrets.io/v1
kind: ClusterExternalSecret
metadata:
  name: {{ $ces.name }}
spec:
  namespaceSelector:
    {{- if $ces.namespaceSelector.matchLabels }}
    matchLabels:
      {{- toYaml $ces.namespaceSelector.matchLabels | nindent 6 }}
    {{- end }}
  externalSecretSpec:
    refreshInterval: {{ $ces.refreshInterval | default "1h" }}
    secretStoreRef:
      kind: {{ $ces.secretStoreRef.kind | default "ClusterSecretStore" }}
      name: {{ $ces.secretStoreRef.name }}
    target:
      name: {{ $ces.target.name }}
      creationPolicy: {{ $ces.target.creationPolicy | default "Owner" }}
      {{- if $ces.target.deletionPolicy }}
      deletionPolicy: {{ $ces.target.deletionPolicy }}
      {{- end }}
    data:
      {{- toYaml $ces.data | nindent 6 }}
{{- end }}

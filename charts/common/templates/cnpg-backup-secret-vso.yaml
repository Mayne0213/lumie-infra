{{- if and .Values.common.database.enabled .Values.common.database.backup.enabled .Values.common.database.backup.useVSO }}
apiVersion: secrets.hashicorp.com/v1beta1
kind: VaultStaticSecret
metadata:
  name: minio-backup-vss
spec:
  vaultAuthRef: vault/vault-auth
  mount: secret
  type: kv-v2
  path: bootstrap/minio
  refreshAfter: 1h
  destination:
    create: true
    name: {{ include "web-app.fullname" . }}-db-backup-creds
    transformation:
      excludeRaw: true
      templates:
        ACCESS_KEY_ID:
          text: "{{ "{{" }} .Secrets.MINIO_ACCESS_KEY_ID {{ "}}" }}"
        ACCESS_SECRET_KEY:
          text: "{{ "{{" }} .Secrets.MINIO_SECRET_ACCESS_KEY {{ "}}" }}"
{{- end }}

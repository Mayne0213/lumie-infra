# Bitnami RabbitMQ Helm Chart Values
# https://github.com/bitnami/charts/tree/main/bitnami/rabbitmq

# Image from Zot registry
image:
  registry: zot0213.kro.kr
  repository: platform/rabbitmq-bitnami
  tag: 4.1.3-debian-12-r1

# Cluster configuration
replicaCount: 3
clustering:
  enabled: true

# Authentication
auth:
  username: lumie
  existingPasswordSecret: rabbitmq-secrets
  existingSecretPasswordKey: rabbitmq-password
  existingErlangSecret: rabbitmq-secrets
  existingSecretErlangKey: rabbitmq-erlang-cookie

# Persistence
persistence:
  enabled: true
  storageClass: local-path
  size: 2Gi

# Resources (based on VPA recommendations)
resources:
  requests:
    cpu: 100m
    memory: 256Mi
  limits:
    memory: 512Mi

# Plugins
plugins: "rabbitmq_management rabbitmq_peer_discovery_k8s rabbitmq_prometheus"

# Extra configuration
extraConfiguration: |-
  cluster_partition_handling = autoheal
  vm_memory_high_watermark.relative = 0.7
  vm_memory_high_watermark_paging_ratio = 0.75
  queue_master_locator = min-masters

# Service configuration
service:
  type: ClusterIP

# Metrics for Prometheus
metrics:
  enabled: true
  serviceMonitor:
    enabled: false

# Pod security context
podSecurityContext:
  fsGroup: 1001
  runAsUser: 1001

containerSecurityContext:
  runAsNonRoot: true
  allowPrivilegeEscalation: false

# Kong Ingress Controller Configuration
# Replaces Traefik as the cluster-wide API Gateway

# Gateway (Kong Proxy) - uses kong/kong subchart
gateway:
  enabled: true

  image:
    repository: kong/kong-gateway
    tag: "3.9"

  env:
    database: "off"
    nginx_worker_processes: "2"
    proxy_access_log: "/dev/stdout"
    admin_access_log: "/dev/stdout"
    proxy_error_log: "/dev/stderr"
    admin_error_log: "/dev/stderr"
    # PROXY Protocol support (HAProxy sends proxy_protocol)
    trusted_ips: "0.0.0.0/0,::/0"
    real_ip_header: "proxy_protocol"
    real_ip_recursive: "on"

  proxy:
    enabled: true
    type: ClusterIP
    http:
      enabled: true
      containerPort: 8000
      servicePort: 80
      parameters:
        - proxy_protocol
    tls:
      enabled: true
      containerPort: 8443
      servicePort: 443
      parameters:
        - http2
        - proxy_protocol

  admin:
    enabled: true
    type: ClusterIP
    clusterIP: None
    http:
      enabled: true
      containerPort: 8001
      servicePort: 8001

  resources:
    requests:
      cpu: 300m
      memory: 512Mi
    limits:
      memory: 512Mi

  replicaCount: 2

  podAnnotations:
    prometheus.io/scrape: "true"
    prometheus.io/port: "8100"

# Controller (Kong Ingress Controller) - uses kong-ingress-controller subchart
controller:
  enabled: true

  ingressController:
    enabled: true
    image:
      repository: kong/kubernetes-ingress-controller
      tag: "3.4"

    gatewayDiscovery:
      enabled: true
      generateAdminApiService: true

  resources:
    requests:
      cpu: 100m
      memory: 128Mi
    limits:
      memory: 256Mi

# Disable test deployment
deployment:
  test:
    enabled: false
